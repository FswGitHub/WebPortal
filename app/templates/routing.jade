script(src='../bower_components/page/page.js')
script.
    window.addEventListener('WebComponentsReady', function () {
        // Removes end / from app.baseUrl which page.base requires for production
        if (window.location.port === '') {  // if production
            page.base(app.baseUrl.replace(/\/$/, ''));
        }

        // Routes

        page('/', function () {
            page('/login');
        });

        page('/login', function (ctx) {
            var token = false;
            var queryString = ctx.querystring;

            if(app.sessionId){
                page('/dashboard');
            } else {
                if (queryString.length > 0) {
                    if (queryString.match(new RegExp('^token='))) {
                        token = queryString.replace('token=', '');
                        //check token valid
                    }
                }
                app.route = {
                    name: 'login',
                    main: false,
                    verify: token
                }
            }
        });
        page('/dashboard', function () {
            if (app.sessionId) {
                app.route = {
                    name: 'dashboard',
                    main: true
                }
            } else {
                page('/login');
            }
        });
        page('/portfolio', function () {
            if(app.sessionId){
                app.route = {
                    name: 'portfolio',
                    main: true
                }
            } else {
                page('/login');
            }
        });
        page('/portfolio/:id', function (data) {
            if(app.sessionId){
                app.route = {
                    name: 'portfolio-item',
                    params: data.params,
                    main: true
                }
            } else {
                page('/login');
            }
        });
        page('/profile', function () {
            if(app.sessionId){
                app.route = {
                    name: 'profile',
                    main: true
                }
            } else {
                page('/login');
            }
        });
        page('/settings', function () {
            if(app.sessionId){
                app.route = {
                    name: 'settings',
                    main: true
                }
            } else {
                page('/login');
            }
        });
        // 404
        page('*', function () {
            page.redirect(app.baseUrl);
        });
        // add #! before urls
        page({
            hashbang: true
        });
    });
