<polymer-element name="signup-page">
    <template>
        <link rel="stylesheet" href="../../../css/signup-page.css">
        <div vertical layout class="signup-page">
            <div class="header">
                <div class="logo"><img src="../../../img/logo-light.png"></div>
            </div>
            <div class="content">
                <paper-shadow z="1">
                    <form vertical layout>
                        <paper-input-decorator id="firstName" label="First Name"
                                               floatingLabel error="Please enter First Name">
                            <input is="core-input" required type="text">
                        </paper-input-decorator>
                        <paper-input-decorator id="lastName" label="Last Name"
                                               floatingLabel error="Please enter Last Name">
                            <input is="core-input" required type="text">
                        </paper-input-decorator>
                        <paper-input-decorator id="email" label="Email"
                                               floatingLabel error="Please enter valid Email">
                            <input is="core-input" required type="email">
                        </paper-input-decorator>
                        <paper-input-decorator id="password" label="Password"
                                               floatingLabel error="Please enter Password">
                            <input is="core-input" required type="password">
                        </paper-input-decorator>
                        <div class="login-button" horizontal layout center>
                            <paper-button class="submit"
                                          on-tap="{{signUpSubmit}}"
                                          raised>Sign Up</paper-button>
                        </div>
                    </form>
                </paper-shadow>
                <div class="create">
                    <div>Already have an account?</div>
                    <paper-button raised>
                        <a href="#!/login">Login</a>
                    </paper-button>
                </div>
            </div>
            <div class="footer">
                <hr>
                2015 Fundamental Software Pty Ltd. All Rights Reserved | Privacy | Terms of Use
            </div>
        </div>
        <paper-action-dialog id="signUpDialog"
                             heading="Error"
                             transition="core-transition-center"
                             backdrop
                             style="width: 300px;"
                             layered="false">
            <p>{{dialogText}}</p>
            <paper-button affirmative autofocus>Ok</paper-button>
        </paper-action-dialog>
        <core-ajax id="signUpSubmitRequest"
                   on-core-error="{{signUpError}}"
                   on-core-response="{{signUpResponse}}"></core-ajax>
    </template>
    <script>
        Polymer('signup-page', {
            ready: function(){
                this.$.signUpSubmitRequest.url = '../resources/json/signup.json'
            },
            signUpSubmit: function(){
                var firstName = this.$.firstName, lastName = this.$.lastName, email = this.$.email, password = this.$.password;

                firstName.validate();
                lastName.validate();
                if(firstName.validate() && lastName.validate() && email.validate() && password.validate()){
                    this.$.signUpSubmitRequest.params = {
                        firstName: firstName.input.value,
                        lastName: lastName.input.value,
                        email: email.input.value,
                        password: password.input.value
                    };
                    this.$.loginSubmitRequest.go();
                }
            },
            signUpError: function(){
                this.dialogText = 'Something wrong, try again later';
                this.$.signUpDialog.toggle();
            },
            signUpResponse: function(e, data){
                if(data.response.success){
                    document.querySelector('app-router').go('!/confirm');
                }else{
                    this.signUpError();
                }
            }
        });
    </script>
</polymer-element>